stages:
- stage: Build
  jobs:
  - job: MainBuild  # Nazwa pierwszego joba (obecnego)
    pool:           # Tutaj możesz określić domyślną pulę dla tego joba
      name: YourDefaultAgentPool # Zmień na nazwę Twojej domyślnej puli agentów
    steps:
    - Dockerfile: 'Dockerfile'
      tags: '1.0'
    # ... inne kroki, które mają działać na domyślnej puli agentów

  - job: ContainerScanningAndSync  # Nowy job dla tasków skanowania i synchronizacji
    pool:                        # Określ tutaj inną pulę agentów dla tego joba
      name: YourCustomAgentPool    # Zmień na nazwę puli, której chcesz użyć dla tych tasków
      # vmImage: 'ubuntu-latest' # Możesz użyć vmImage dla hostowanych agentów
    steps:
    - task: BskContainerScanning@3
      inputs:
        scanningRegistry: 'acr'
        ScanningServiceEndpoint: 'P08399-BSK-Prisma-SC'
        ACREndpoint: 'P08399-hceACR-ACR-read'
        Image: 'P08399/gatling-test'
        Tag: '1.0'
        continueOnError: true

    - task: CDaaSContainerSync@2
      retryCountOnFailure: 5
      inputs:
        ImageName: 'p08399hceacr.azurecr.io/gatling-test:1.0'
        sourceCredentials: 'serviceconnection'
        sourceEndpoint: 'P08399-hceACR-ACR-read'
        targetCredentials: 'serviceconnection'
        targetEndpoint: 'P08399-Harbor-PUSH'
        displayName: 'Copy gatling-test:1.0 to BSK Harbor registry'
