# Wymagania i Scenariusze Testowe - Google Pay dla Dziecka (6-12 lat)

Ten dokument zawiera specyfikację danych bazowych i szczegółowe przypadki testowe (payloady, oczekiwane wyniki) dla endpointów API używanych do weryfikacji kwalifikacji i digitalizacji tokenu Google Pay w kontekście dziecka.

## 1. Wymagane Dane Testowe i Stan Bazowy w Systemie ING

Aby testy były w pełni weryfikowalne, w systemie testowym (SIT/UAT) muszą być przygotowane profile klientów symulujące następujące stany:

| ID Klienta Testowego | Rola | Stan Biznesowy (Wymagany) | Status Karty Dziecka | Uwagi |
| :---: | :---: | :---: | :---: | :--- |
| **P-DATA** | Rodzic (Sukces) | Dziecko **6-12 lat**. Rodzic ma aktywną bankowość i numer tel. do SCA. | **AKTYWNA** | [**Scenariusz Pozytywny**] |
| **N-DATA-LIMIT** | Rodzic (Limit Tokenów) | Dziecko 6-12 lat. Osiągnięto **maksymalną liczbę tokenów** (np. 3). | AKTYWNA | Test V-N-002 |
| **N-DATA-WIEK** | Rodzic (Błąd Wieku) | Dziecko **13+ lat** (poza limitem). | (Nieważny) | Test C-N-003 |
| **N-DATA-NO-TEL** | Rodzic (Brak Tel. SCA) | Dziecko 6-12 lat. Klient **nie ma** numeru tel. do autoryzacji w profilu. | AKTYWNA | Test V-N-004 |
| **N-DATA-BLOK** | Rodzic (Karta Zablokowana) | Dziecko 6-12 lat. | **ZABLOKOWANA** | Test C-N-002 |

---

## 2. Testy API dla `/api/google/child/inapp/check` (Kwalifikacja)

**ENDPOINT:** `[URL_API]/api/google/child/inapp/check`
**METODA:** `POST`
**CEL:** Sprawdzenie, czy dany klient i karta spełniają kryteria biznesowe (wiek, status karty).

| ID Testu | Scenariusz | Header Payload (`customer-info` dekodowane) | Body JSON (Przykładowe) | Oczekiwany Wynik API |
| :---: | :--- | :--- | :--- | :--- |
| **C-P-001** | **Pozytywny.** Pomyślna kwalifikacja. | **P-DATA**: authenticated: true, childLogins w zakresie 6-12 lat. | `{"locale": "pl", "source": "ING_MOBILE_APP"}` | **HTTP 200 OK.** status **`ELIGIBLE`** / `OK`. |
| **C-N-002** | **Negatywny.** Karta dziecka **zablokowana**. | **N-DATA-BLOK**: childLogins z kartą w statusie **ZABLOKOWANA**. | `{"locale": "pl", "source": "ING_MOBILE_APP"}` | **HTTP 400** / 200. Błąd: **`CARD_BLOCKED`** / `CARD_NOT_ACTIVE`. |
| **C-N-003** | **Negatywny.** Klient za stary (wiek > 12). | **N-DATA-WIEK**: childLogins z wiekiem **14 lat**. | `{"locale": "pl", "source": "ING_MOBILE_APP"}` | **HTTP 400** / 200. Błąd: **`AGE_LIMIT_EXCEEDED`**. |
| **C-N-004** | **Negatywny.** Brak autoryzacji sesji. | **Nieważny sessionID** lub **authenticated: false**. | `{"locale": "pl", "source": "ING_MOBILE_APP"}` | **HTTP 401 Unauthorized**. Błąd: **`INVALID_SESSION`**. |

---

## 3. Testy API dla `/api/google/child/inapp/verify` (Digitalizacja Tokenu)

**ENDPOINT:** `[URL_API]/api/google/child/inapp/verify`
**METODA:** `POST`
**CEL:** Weryfikacja procesu digitalizacji i ID tokena przed finalizacją.

| ID Testu | Scenariusz | Header Payload (`customer-info` dekodowane) | Body JSON (Kluczowe Zmiany) | Oczekiwany Wynik API |
| :---: | :--- | :--- | :--- | :--- |
| **V-P-001** | **Pozytywny.** Pomyślna weryfikacja tokenu. | **P-DATA**: Poprawny sessionID. | `{"tokenUniqueReferenceId": "**TOKEN_READY_FOR_VERIFY**", "sessionCode": "ID_SESJI_Z_NAGŁÓWKA"}` | **HTTP 200 OK.** status **`SUCCESS`** / `PROVISIONED`. |
| **V-N-002** | **Negatywny.** Przekroczony **limit tokenów**. | **N-DATA-LIMIT**: Poprawny sessionID. | `{"tokenUniqueReferenceId": "TOKEN_READY_FOR_VERIFY", "sessionCode": "ID_SESJI_Z_NAGŁÓWKA"}` | **HTTP 400** / 200. Błąd: **`TOKEN_LIMIT_EXCEEDED`**. |
| **V-N-003** | **Negatywny.** **Nieznany/Niepowiązany** ID tokenu. | **P-DATA**: Poprawny sessionID. | `{"tokenUniqueReferenceId": "**RANDOM_INVALID_ID**", "sessionCode": "ID_SESJI_Z_NAGŁÓWKA"}` | **HTTP 400** / 200. Błąd: **`INVALID_TOKEN_REFERENCE`**. |
| **V-N-004** | **Negatywny.** Brak numeru telefonu do autoryzacji (SCA). | **N-DATA-NO-TEL**: Poprawny sessionID. | `{"tokenUniqueReferenceId": "TOKEN_READY_FOR_VERIFY", "sessionCode": "ID_SESJI_Z_NAGŁÓWKA"}` | **HTTP 400** / 200. Błąd: **`SCA_TEL_MISSING`** / `AUTH_METHOD_NOT_SET`. |
| **V-N-005** | **Negatywny.** Brak wymaganego pola w Body. | **P-DATA**: Poprawny sessionID. | `{"sessionCode": "ID_SESJI_Z_NAGŁÓWKA"}` (brak tokenUniqueReferenceId) | **HTTP 400 Bad Request**. Błąd: **`MISSING_MANDATORY_FIELD`**. |
