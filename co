- task: ArchiveFiles@2
      displayName: 'Compress All Target Contents' # Translated display name
      inputs:
        # Remember, 'fetch' creates a subfolder with the hostname, e.g., /fetched_all_target_contents/your_remote_host_name/app/target/all_target_contents/
        rootFolderOrFile: '$(System.DefaultWorkingDirectory)/fetched_all_target_contents/{{ inventory_hostname }}/app/target/all_target_contents/' # <--- PRECISE PATH after fetch
        includeRootFolder: true # Whether to also compress the 'all_target_contents' folder itself inside the archive
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/full_target_contents_$(Build.BuildId).zip' # New archive name
        replaceExistingArchive: true
      condition: succeeded() # Run if Ansible Playbook succeeded (including fetch)

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Full Target Archive as Artifact' # Translated display name
      inputs:
        pathToPublish: '$(Build.ArtifactStagingDirectory)/full_target_contents_$(Build.BuildId).zip' # Path to the compressed file
        artifactName: 'FullTargetContentsArchive' # <--- New, unique artifact name
        publishLocation: 'Container'
      condition: succeeded()
