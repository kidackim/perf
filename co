- script: |
    if [ "$(Agent.JobStatus)" == "Succeeded" ]; then
      STATUS="Success"
      STATUS_COLOR="green"
    elif [ "$(Agent.JobStatus)" == "Failed" ]; then
      STATUS="Failure"
      STATUS_COLOR="red"
    else
      STATUS="Warning"
      STATUS_COLOR="orange"
    fi

    # Tworzymy listę adresatów
    MAIL_TO=$(parameters.recipient1),$(parameters.recipient2),$(parameters.recipient3)

    cd playbooks
    ansible-playbook "scripts/send-test-results-mail.yml" \
    --extra-vars "mail_to=$MAIL_TO" \
    --extra-vars "status=$STATUS" \
    --extra-vars "status_color=$STATUS_COLOR" \
    --extra-vars "build=$(Build.BuildNumber)" \
    --extra-vars "project_url=https://dev.azure.com/IngEurCdaaS01/IngOne/_build/results?buildId=$(Build.BuildId)"
  displayName: 'Send Test Results by Mail'
  condition: always()
  env:
    SYSTEM_ACCESSTOKEN: $(System.AccessToken)
