# Zdefiniuj zmienne, aby łatwiej zarządzać nazwami
variables:
  imageName: 'p08399-test-performance-hce'
  tag: '$(Build.BuildId)'

stages:
- stage: BuildAndTest
  displayName: 'Build and Run Tests'
  jobs:
  - job: Test
    displayName: 'Build and Test Job'
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    # Krok 1: Budowanie obrazu Docker
    # Ten krok pozostaje taki sam, buduje obraz na podstawie Twojego Dockerfile.
    - task: Docker@2
      displayName: 'Build an image'
      inputs:
        command: 'build'
        dockerfile: '$(Build.SourcesDirectory)/Dockerfile'
        # Tagujemy obraz, używając zdefiniowanych zmiennych
        tags: '$(imageName):$(tag)'

    # Krok 2: Uruchomienie testów wewnątrz kontenera
    # Ten nowy krok wykonuje 'docker run' na obrazie zbudowanym w poprzednim kroku.
    - script: |
        docker run --rm $(imageName):$(tag)
      displayName: 'Run tests in container'
