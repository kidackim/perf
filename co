FROM registry.access.redhat.com/ubi9/nodejs-22

ARG MICRODIR=/microdir
ARG PIP_ROOT_USER_ACTION=ignore
ARG LANG=en_US.UTF-8
ARG LANGUAGE=en_US.UTF-8
ARG LC_COLLATE=C
ARG LC_CTYPE=en_US.UTF-8
ARG NLS_OS_CHARSET=AL32UTF8
ARG USE_GKE_GCLOUD_AUTH_PLUGIN=True

LABEL maintainer="ci.cd@ing.pl"

ENV PIP_ROOT_USER_ACTION=${PIP_ROOT_USER_ACTION} \
    LANG=${LANG} \
    LANGUAGE=${LANGUAGE} \
    LC_COLLATE=${LC_COLLATE} \
    LC_CTYPE=${LC_CTYPE} \
    NLS_OS_CHARSET=${NLS_OS_CHARSET} \
    USE_GKE_GCLOUD_AUTH_PLUGIN=${USE_GKE_GCLOUD_AUTH_PLUGIN}

WORKDIR /usr/src

ENV NODE_TLS_REJECT_UNAUTHORIZED=0

COPY package*.json ./
RUN npm config set strict-ssl false && \
    npm install

COPY . .

COPY sample.env .env

CMD ["/bin/sh", "-c", "npm run test"]
